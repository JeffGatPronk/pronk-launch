<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Upload Pronk PDF to TMS Procedure Readings</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #status { margin-top: 10px; color: green; }
    #error { margin-top: 10px; color: red; }
  </style>
</head>
<body>

<h2>Upload Pronk PDF to TMS Procedure Readings</h2>

<p>Select the PDF file below. Upload will start automatically once selected.</p>

<form id="uploadForm" target="uploadFrame"
      action="https://fhbio.stage.tmsonline.com/tms/tmsconnect/fileexchange"
      method="POST" enctype="multipart/form-data">

  <!-- Hardcoded WorkOrderID -->
  <input type="hidden" name="WorkOrderID" value="186494">

  <!-- Description shown in TMS -->
  <input type="hidden" name="Description" value="Pronk Mobilize Test Report">

  <!-- DocumentType set explicitly to Procedure Readings -->
  <input type="hidden" name="DocumentType" value="ProcedureAttachment">

  <!-- Do not overwrite by default -->
  <input type="hidden" name="Overwrite" value="false">

  <!-- User selects PDF -->
  <input type="file" name="File" id="fileInput" accept=".pdf" required>
</form>

<!-- Hidden iframe so page does not navigate away -->
<iframe name="uploadFrame" style="display:none;"></iframe>

<div id="status"></div>
<div id="error"></div>

<script>
  const form = document.getElementById('uploadForm');
  const fileInput = document.getElementById('fileInput');
  const status = document.getElementById('status');
  const error = document.getElementById('error');

  // Automatically submit form when file is selected
  fileInput.addEventListener('change', () => {
    if (fileInput.files.length === 0) {
      error.textContent = "No file selected.";
      return;
    }
    status.textContent = "Uploading...";
    error.textContent = "";
    form.submit();

    // Show success message after ~3 seconds
    setTimeout(() => {
      status.textContent = "Upload complete! Check Procedure Readings in TMS Work Order 186494.";
      // Attempt to close page (may be blocked by browser)
      window.close();
    }, 3000);
  });
</script>

</body>
</html>
