<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Pronk Mobilize Invisible Launcher</title>
</head>
<body>
<script>
  // --- Helper to get TMS query parameters ---
  function getParam(name) {
    const q = window.location.search.substring(1);
    const pairs = q.split('&');
    for (const pair of pairs) {
      const [key, ...rest] = pair.split('=');
      if (decodeURIComponent(key).trim() === name) {
        return decodeURIComponent(rest.join('=')).trim();
      }
    }
    return null;
  }

  // --- Dynamic Asset from TMS ---
  const asset =
    getParam("Asset ID") ||
    getParam("AssetID") ||
    getParam("assetid") ||
    getParam("asset_number") ||
    "t1234";

  // --- Literal autotest block ---
  const autotest = '{"NFPA992012APwGND","2sec,Rpt,PwrEnd,A","GndRes,500","NP:CL:NC,100","NP:CL:OG,500","NP:LLG:NC,100","NP:LLG:OG,500"}';

  // --- Build Pronk URL ---
  const pronkUrl = `pronk://devtype?asset=${asset}&output=json&autotest=${autotest}`;

  console.log("Launching Mobilize:", pronkUrl);

  // --- Launch Mobilize via invisible window ---
  try {
    const tempWin = window.open(pronkUrl, "_blank"); // triggers Mobilize
    if (tempWin) tempWin.close(); // auto-close immediately
  } catch(e) {
    console.error("Mobilize launch failed:", e);
  }

  // --- Auto-close launcher window if possible ---
  setTimeout(() => { try { window.close(); } catch(e) {} }, 500);
</script>
</body>
</html>
