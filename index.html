<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Pronk Mobilize Launcher</title>
<style>
body { font-family: sans-serif; text-align: center; margin-top: 50px; }
#launchButton {
    padding: 20px 40px;
    font-size: 18px;
    background-color: #0078D7;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}
#launchButton:hover { background-color: #005a9e; }
</style>
</head>
<body>
<h2>Pronk Mobilize Launcher</h2>
<p>The test should launch automatically. If not, click the button below:</p>

<button id="launchButton">Launch Pronk Mobilize</button>

<script>
// -----------------------------
// Helper: Get TMS parameters robustly
// -----------------------------
function getParam(name) {
    const query = window.location.search.substring(1);
    const pairs = query.split('&');
    for (const pair of pairs) {
        const [key, ...rest] = pair.split('=');
        if (decodeURIComponent(key).trim().toLowerCase() === name.trim().toLowerCase()) {
            return decodeURIComponent(rest.join('=')).trim();
        }
    }
    return null;
}

// -----------------------------
// Capture WorkOrder and Asset
// -----------------------------
const WORKORDER_NUMBER = getParam("WO Number") || getParam("WorkOrderNumber") || "";
const ASSET_NUMBER = getParam("Asset ID") || getParam("AssetID") || "";

console.log("Captured Parameters:");
console.log("WorkOrder:", WORKORDER_NUMBER);
console.log("Asset:", ASSET_NUMBER);

if (!WORKORDER_NUMBER || !ASSET_NUMBER) {
    alert("Missing Asset or Work Order from TMS. Cannot launch.");
    throw new Error("Missing required parameters.");
}

// -----------------------------
// Autotest JSON (example placeholder)
// -----------------------------
const autotestJSON = '{"NFPA992012NOGND","2sec,Rpt,PwrEnd,A","NP:CL:NC,100"}';
const autotestEncoded = encodeURIComponent(autotestJSON);

// -----------------------------
// Build Pronk cheatcode URL
// -----------------------------
const pronkUrl = `pronk://cheatcode?cheatvar1=open&asset=${ASSET_NUMBER}&workOrder=${WORKORDER_NUMBER}&output=json&callback=pronkexe://result/&autotest=${autotestEncoded}`;

console.log("Pronk URL:", pronkUrl);

// -----------------------------
// Auto-launch Mobilize on page load
// -----------------------------
window.onload = function() {
    try {
        window.location.href = pronkUrl;
    } catch(e) {
        console.error("Failed to launch Pronk:", e);
    }
};

// -----------------------------
// Fallback button click
// -----------------------------
document.getElementById('launchButton').onclick = function() {
    try {
        window.location.href = pronkUrl;
    } catch(e) {
        console.error("Failed to launch Pronk:", e);
    }
};
</script>
</body>
</html>
