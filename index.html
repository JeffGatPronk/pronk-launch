<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Pronk Mobilize</title>
  <script>
    // Capture all TMS parameters dynamically
    const params = new URLSearchParams(window.location.search);
    const passthrough = [];
    for (const [key, value] of params.entries()) {
      if (key.toLowerCase() !== "autotest") {
        passthrough.push(`${encodeURIComponent(key)}=${encodeURIComponent(value)}`);
      }
    }

    // Fixed autotest block
    const autotestBlock = '{"NFPA992012APwGND","2sec,Rpt,PwrEnd,A","GndRes,500","NP:CL:NC,100","NP:CL:OG,500","NP:LLG:NC,100","NP:LLG:OG,500"}';

    // Build final Pronk deep link with devtype=json
    let pronkUrl = "pronk://open?devtype=json";
    if (passthrough.length > 0) {
      pronkUrl += "&" + passthrough.join("&") + "&autotest=" + autotestBlock;
    } else {
      pronkUrl += "&autotest=" + autotestBlock;
    }

    // Function to simulate user click (required for Chrome/Edge/Safari)
    function launchMobilize() {
      const link = document.createElement('a');
      link.href = pronkUrl;
      link.style.display = "none";
      document.body.appendChild(link);
      link.click();  // Browser treats as user action → Pronk launches
    }

    // Launch on page load and close browser window
    window.onload = function() {
      launchMobilize();
      setTimeout(() => window.close(), 600); // Close popup after 0.6s
    };
  </script>
</head>
<body>
  <p style="font-family: sans-serif;">Launching Pronk Mobilize…</p>
</body>
</html>
