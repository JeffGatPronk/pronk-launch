<!DOCTYPE html>
<html>
<head>
    <title>Launch Pronk Mobilize</title>
</head>
<body>
    <h2>Launching Pronk Mobilize...</h2>

    <script>
        // === READ PARAMETERS FROM TMS URL ===
        const params = new URLSearchParams(window.location.search);
        const ASSET_NUMBER = params.get("asset");
        const WORKORDER_NUMBER = params.get("workOrder");

        if (!ASSET_NUMBER || !WORKORDER_NUMBER) {
            document.body.innerHTML = "<h3 style='color:red;'>Missing asset or workOrder parameter</h3>";
            console.error("Missing parameters:", window.location.search);
        } else {

            // === BUILD CALLBACK URL (DO NOT ENCODE) ===
            const callbackUrl = `pronkexe://result/?asset=${ASSET_NUMBER}&workOrder=${WORKORDER_NUMBER}`;

            // === BUILD PRONK LAUNCH URL ===
            const autotest = "true";  // change if needed

            const pronkUrl =
                `pronk://devtype?asset=${ASSET_NUMBER}` +
                `&workOrder=${WORKORDER_NUMBER}` +
                `&output=json` +
                `&callback=${callbackUrl}` +
                `&autotest=${autotest}`;

            // === DEBUG LOGGING ===
            console.log("ASSET:", ASSET_NUMBER);
            console.log("WORK ORDER:", WORKORDER_NUMBER);
            console.log("CALLBACK URL:", callbackUrl);
            console.log("LAUNCHING PRONK URL:", pronkUrl);

            // === LAUNCH MOBILIZE ===
            window.location.href = pronkUrl;
        }
    </script>
</body>
</html>
