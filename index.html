<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pronk Mobilize Launcher</title>
<style>
  body { font-family: sans-serif; text-align: center; margin-top: 50px; }
  #launchButton {
    padding: 20px 40px;
    font-size: 18px;
    background-color: #0078D7;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  #launchButton:hover { background-color: #005a9e; }
</style>
<script>
// --- Helper to parse TMS query parameters ---
function getParam(name) {
  const q = window.location.search.substring(1);
  const pairs = q.split('&');
  for (const pair of pairs) {
    const [key, ...rest] = pair.split('=');
    if (decodeURIComponent(key).trim() === name) {
      return decodeURIComponent(rest.join('=')).trim();
    }
  }
  return null;
}

// --- Capture TMS parameters ---
const WORKORDER_NUMBER = getParam("WO Number") || getParam("WorkOrderNumber");
const ASSET_NUMBER = getParam("Asset ID") || getParam("AssetID");

if (!WORKORDER_NUMBER || !ASSET_NUMBER) {
  document.addEventListener("DOMContentLoaded", () => {
    document.body.innerHTML = `<h2 style="color:red;">Missing Asset or Work Order from TMS. Cannot launch.</h2>`;
  });
  throw new Error("Missing required parameters");
}

// --- Define autotest JSON block (example) ---
const autotest = '{"NFPA992012NOGND","2sec,Rpt,PwrEnd,A","NP:CL:NC,100","NP:CL:OG,500"}';

// --- Build Mobilize launch URL ---
const pronkUrl = `pronk://cheatcode?cheatvar1=open&asset=${ASSET_NUMBER}&workOrder=${WORKORDER_NUMBER}&&callback=pronkexe://result/&autotest=${autotest}`;


console.log("Pronk Launch URL:", pronkUrl);

// --- Launch function ---
function launchPronk() {
  try {
    window.location.href = pronkUrl;
  } catch(e) {
    console.error("Launch failed:", e);
  }
}

// --- Auto-launch on page load ---
window.onload = function() {
  launchPronk();
};
</script>
</head>
<body>
  <h2>Pronk Mobilize Launcher</h2>
  <p>Launching test automatically... If it does not start, click the button below:</p>
  <button id="launchButton" onclick="launchPronk()">Launch Pronk Mobilize</button>
</body>
</html>
