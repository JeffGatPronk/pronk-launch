<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pronk Mobilize Launcher</title>
<style>
  body { font-family: sans-serif; text-align: center; margin-top: 50px; }
  #launchButton {
    padding: 20px 40px;
    font-size: 18px;
    background-color: #0078D7;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  #launchButton:hover { background-color: #005a9e; }
</style>
<script>
  // Helper to parse query parameters
  function getParam(name) {
    const q = window.location.search.substring(1);
    const pairs = q.split('&');
    for (const pair of pairs) {
      const [key, ...rest] = pair.split('=');
      if (decodeURIComponent(key).trim() === name) {
        return decodeURIComponent(rest.join('=')).trim();
      }
    }
    return null;
  }

  // Capture TMS parameters
  const ASSET_NUMBER = getParam("Asset ID") || getParam("AssetID") || "000011";
  const WORKORDER_NUMBER = getParam("WO Number") || getParam("WorkOrderNumber") || "186496";

  // Autotest JSON example
  const autotest = `{"NFPA992012NOGND","2sec,Rpt,PwrEnd,A","NP:CL:NC,100","NP:CL:OG,500"}`;

  // Validate parameters
  if (!ASSET_NUMBER || !WORKORDER_NUMBER) {
    alert("Missing Asset or Work Order from TMS. Cannot launch.");
    throw new Error("Missing required TMS parameters.");
  }

  // Build Mobilize cheatcode URL
  const pronkUrl =
    `pronk://cheatcode?` +
    `cheatvar1=open` +
    `&asset=${encodeURIComponent(ASSET_NUMBER)}` +
    `&workOrder=${encodeURIComponent(WORKORDER_NUMBER)}` +
    `&output=json` +
    `&callback=${encodeURIComponent("pronkexe://result/")}` +
    `&autotest=${encodeURIComponent(autotest)}`;

  console.log("Mobilize URL:", pronkUrl);

  // Launch function
  function launchPronk() {
    window.location.href = pronkUrl;
  }

  // Auto-launch on page load
  window.onload = function() {
    launchPronk();
  };
</script>
</head>
<body>
  <h2>Pronk Mobilize Launcher</h2>
  <p>If the test does not launch automatically, click the button below:</p>
  <button id="launchButton" onclick="launchPronk()">Launch Pronk Mobilize</button>
</body>
</html>
